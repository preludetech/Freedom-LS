{% extends 'student_interface/home.html' %}
{% load dict_filters %}

{% block all_courses %}
{% endblock all_courses %}


{% partialdef activity_radio %}

<!-- <i class="fa fa-check-circle" aria-hidden="true"></i>
<i class="fa fa-times-circle" aria-hidden="true"></i>
<i class="fa fa-question-circle" aria-hidden="true"></i> -->



{% endpartialdef %}



{% block user_authenticated %}

<div class="border border-gray-300 rounded-md p-4">
    <h2>Children</h2>
    <a href="{% url 'bloom_student_interface:child_create' %}" class="btn btn-primary">Add Child</a>

    {% if children %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for child in children %}
                <div class="border border-gray-300 rounded-md p-4 flex flex-col">
                    <div class="mb-4">
                        <h3 class="">{{ child.name }}</h3>

                        {% with committed=child.activities.all %}
                        {% if committed %}
                            <div class="mt-3">
                                <h4 class="">Committed Activities:</h4>
                                <table>
                                    
                                    {% for commitment in committed %}
                                    <tr>
                                        <td>
                                            <a href="{% url 'bloom_student_interface:child_activity' child.slug commitment.activity.slug %}" class="text-blue-600 hover:underline">
                                                {{ commitment.activity.title }}
                                            </a>
                                        </td>
                                        <td class="pl-3">
                                            {% if child.id in activity_logs_today and commitment.activity.id in activity_logs_today|dict_get:child.id %}
                                                {% with status=activity_logs_today|dict_get:child.id|dict_get:commitment.activity.id %}
                                                    {% if status == True %}
                                                        <i class="fa fa-check-circle text-green-600" title="Done today"></i>
                                                    {% elif status == False %}
                                                        <i class="fa fa-times-circle text-red-600" title="Not done today"></i>
                                                    {% elif status == None %}
                                                        <i class="fa fa-question-circle text-gray-400" title="Not yet marked"></i>
                                                    {% endif %}
                                                {% endwith %}
                                            {% else %}
                                                <i class="fa fa-question-circle text-gray-400" title="Not yet marked"></i>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    {% endfor %}
                                </table>
                            </div>
                        {% endif %}
                        {% endwith %}
                    </div>
                    <div class="flex flex-col gap-2 mt-auto">
                        <a href="{% url 'bloom_student_interface:child_assessment' child.slug %}" class="btn btn-primary">Picky Eating Assessment</a>
                        <a href="{% url 'bloom_student_interface:child_activities' child.slug %}" class="btn btn-primary">Activities</a>
                        <div class="flex gap-2">
                            <a href="{% url 'bloom_student_interface:child_edit' child.pk %}" class="btn btn-outline">Edit</a>
                            <form method="post" action="{% url 'bloom_student_interface:child_delete' child.pk %}" onsubmit="return confirm('Are you sure you want to delete {{ child.name }}?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-secondary">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-600">No children yet. Click "Add Child" to create one.</p>
    {% endif %}
</div>


<div>
    <h2>Current Courses</h2>

    {% if registered_courses %}
            <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                {% for course in registered_courses %}
                        {% include "student_interface/partials/course_list.html#course-card" %}
                {% endfor %}
            </div>

    {% else %}
        <p class="text-gray-600">You haven't signed up for any courses yet</p>
    {% endif %}
</div>


<div class="border border-gray-300 rounded-md p-4">
    <h2>Recommended Courses</h2>

    {% if recommended_courses %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for recommendation in recommended_courses %}
                <div class="border border-gray-300 rounded-md p-4 flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg">{{ recommendation.collection.title }}</h3>
                        {% if recommendation.collection.description %}
                            <p class="text-gray-600">{{ recommendation.collection.description }}</p>
                        {% endif %}
                    </div>
                    <div class="flex flex-col gap-2 mt-auto">
                        <a href="{% url 'student_interface:course_home' recommendation.collection.slug %}" class="btn btn-primary">View Course</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-600">No recommended courses yet.</p>
    {% endif %}

</div>

{% endblock user_authenticated %}
