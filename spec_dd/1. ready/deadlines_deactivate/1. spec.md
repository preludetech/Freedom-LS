# Spec: Deadlines Feature Flag (Deactivation)

## Problem

Querying deadlines from the database has a performance cost. Not all Freedom LS deployments use deadlines. When deadlines are not needed, the system should skip all deadline-related database queries and UI rendering in the student interface to improve performance.

## Solution

Use the existing `DEADLINES_ACTIVE` setting (defined in `freedom_ls/student_management/config.py`, overridable via Django settings) to gate all deadline-related behaviour in the student interface. When `DEADLINES_ACTIVE` is `False`:

1. **No deadline database queries** — skip the call to `get_course_deadlines()` in `get_course_index()`, and skip the call to `is_item_locked()` in `view_course_item()` (which internally calls `get_effective_deadlines()`)
2. **No deadline badge rendering** — deadline badges are not shown in the course table of contents
3. **No hard-deadline locking** — items are never marked as BLOCKED due to expired deadlines; students can access all content

### Scope

This change affects the **student interface only**. The admin and educator interfaces remain unaffected — educators can still create and manage deadlines even when they are deactivated for students. This allows deployments to pre-configure deadlines before activating them.

## Affected code

### 1. `freedom_ls/student_interface/utils.py` — `get_course_index()`

Currently calls `get_course_deadlines(student, course)` whenever a student exists (line 144), regardless of whether deadlines are active. When `DEADLINES_ACTIVE` is `False`, skip this call and use an empty dict instead. Downstream functions (`_get_deadlines_for_item`, `_apply_deadline_locking`) will receive no deadline data and naturally produce no deadline badges or locking.

### 2. `freedom_ls/student_interface/views.py` — `view_course_item()`

Currently calls `is_item_locked(student, course, current_item, is_completed=is_completed)` unconditionally (line 147). When `DEADLINES_ACTIVE` is `False`, skip this check (treat as not locked).

Rename `is_item_locked` to make it more explicit. There are many reasons it can be locked. Rather `is_item_locked_by_deadline`

### 3. Templates — no changes needed

The template `student_interface/partials/course_minimal_toc.html` renders deadline badges conditionally based on data passed from views. When no deadline data is present, no badges are rendered and no items are blocked. No template changes are required.

## Why this matters

- **Performance** — Deployments without deadlines avoid unnecessary database queries on every course page load. The `get_course_deadlines()` function queries multiple tables (CohortDeadlines, StudentDeadlines, StudentCohortDeadlineOverrides, registrations) even when no deadline data exists.
- **Clean opt-in** — The feature flag pattern lets deployers activate deadlines when ready, without code changes.

## Decisions

| Decision | Rationale |
|----------|-----------|
| Student interface only | Educators may want to set up deadlines before activating them for students |
| Disable locking when inactive | Deadlines being inactive means the entire deadline system is off — locking is part of that system |
| Check config at query sites, not in utility functions | Keeps the utility functions pure (they do what they're asked) and makes the feature flag explicit at the call sites |
| No template changes | The templates already handle empty deadline data gracefully |

## Success criteria

1. When `DEADLINES_ACTIVE` is `False` (either as the config default or overridden in Django settings), no deadline-related database queries are executed in the student interface
2. When `DEADLINES_ACTIVE` is `False`, no deadline badges appear in the course table of contents
3. When `DEADLINES_ACTIVE` is `False`, no items are locked due to expired hard deadlines
4. When `DEADLINES_ACTIVE` is `True` (the default), behaviour is unchanged from the current implementation
5. Admin and educator interfaces are unaffected by the setting
6. All existing deadline tests continue to pass
7. New tests verify the feature flag behaviour in both states

## IMPORTANT 

Do not attempt to edit the default value of `DEADLINES_ACTIVE` or override it in any of the settings files.  When testing this functionality, use mocks or similar to set the `DEADLINES_ACTIVE` value.