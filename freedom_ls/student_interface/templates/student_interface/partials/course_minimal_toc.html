{% partialdef status-icon %}
    {% if child.status == "BLOCKED" %}
        <span class="text-sm text-gray-400">
            <i class="fa fa-lock"></i>
        </span>
    {% elif child.status == "READY" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "IN_PROGRESS" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "COMPLETE" %}
        <a href="{{ child.url }}"
           class="text-green-600 hover:text-green-700 no-underline">
            <i class="fa fa-check"></i>
        </a>
    {% elif child.status == "FAILED" %}
        <a href="{{ child.url }}"
           class="text-red-600 hover:text-red-700 no-underline">
            <i class="fa fa-repeat"></i>
        </a>
    {% else %}
        <span class="text-sm text-red-600">Unknown status "{{ child.status }}"</span>
    {% endif %}
{% endpartialdef %}

{% partialdef course-children %}
    {% for child in children %}
        {% if child.type == "COURSE_PART" %}
            {# Course Part with expandable children #}
            <div x-data="{ expanded: false }" class="py-2">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 flex-1">
                        <span class="text-gray-400 pr-2">{{ forloop.counter }}.</span>
                        <button @click="expanded = !expanded"
                                class="flex items-center gap-3 text-left hover:text-blue-600 transition-colors cursor-pointer">
                            <span class="text-gray-500">
                                <i class="fa fa-folder"></i>
                            </span>
                            <span>{{ child.title }}</span>

                            <span class="text-sm text-gray-400">
                                <i class="fa" :class="expanded ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
                                <!-- @claude: if the child title is very long, then the chevron overlaps with the status icon at the end. Make sure it is neat even with long titles -->
                            </span>
                        </button>
                    </div>
                    {% partial status-icon %}
                </div>
                {# Nested children of course part #}
                <div x-show="expanded"
                     x-collapse
                     class="ml-12 mt-2 space-y-2 border-l-2 border-gray-200 pl-4">
                    {% if child.children %}
                        {% for part_child in child.children %}
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center gap-3">
                                    <span class="text-gray-500">
                                        {% if part_child.type == "TOPIC" %}
                                            <i class="fa fa-book"></i>
                                            <!-- @claude: this code is not DRY. child names, icons and links should be defined once in a template
                                             the counter should also be displayed. 1.1, 1.2 etc -->
                                        {% elif part_child.type == "FORM" %}
                                            <i class="fa fa-edit"></i>
                                        {% elif part_child.type == "COURSE" %}
                                            <i class="fa fa-graduation-cap"></i>
                                        {% endif %}
                                    </span>
                                    {% if part_child.url %}
                                        <a href="{{ part_child.url }}"
                                           class="text-gray-600 hover:text-primary-600">{{ part_child.title }}</a>
                                    {% else %}
                                        <span class="text-gray-600">{{ part_child.title }}</span>
                                        <!-- @claude: the title should be displayed in a consistent way. Make rendering specific elements DRY -->
                                    {% endif %}
                                </div>
                                {% with child=part_child %}
                                    {% partial status-icon %}
                                {% endwith %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <span class="text-sm text-gray-400 italic">No items in this part</span>
                    {% endif %}
                </div>
            </div>
        {% else %}
            {# Regular content item (Topic, Form, Course) #}
            <div class="flex items-center justify-between py-2">
                <div class="flex items-center gap-3">
                    <span class="text-gray-400 pr-2">{{ forloop.counter }}.</span>
                    <span class="text-gray-500">
                        {% if child.type == "TOPIC" %}
                            <i class="fa fa-book"></i>
                        {% elif child.type == "FORM" %}
                            <i class="fa fa-edit"></i>
                        {% elif child.type == "COURSE" %}
                            <i class="fa fa-graduation-cap"></i>
                        {% endif %}
                    </span>
                    {% if child.url %}
                        <a href="{{ child.url }}">{{ child.title }}</a>
                    {% else %}
                        <span>{{ child.title }}</span>
                    {% endif %}
                </div>
                {% partial status-icon %}
            </div>
        {% endif %}
    {% endfor %}
{% endpartialdef %}

<div class="space-y-2">
    <h1 class="text-2xl">
        {{ course.title }}
    </h1>
    {% if course.subtitle %}
        <p class="text-xl text-gray-600">
            {{ course.subtitle }}
        </p>
    {% endif %}
</div>
<div class="mt-8">
    <h2 class="text-xl">
        Contents
    </h2>
    <div class="mt-4">
        {% partial course-children %}
    </div>
</div>
