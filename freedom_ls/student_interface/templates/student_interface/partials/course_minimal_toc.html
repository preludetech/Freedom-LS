{% partialdef status-icon %}
    {% if child.status == "BLOCKED" %}
        <span class="text-sm text-gray-400">
            <i class="fa fa-lock"></i>
        </span>
    {% elif child.status == "READY" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "IN_PROGRESS" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "COMPLETE" %}
        <a href="{{ child.url }}"
           class="text-green-600 hover:text-green-700 no-underline">
            <i class="fa fa-check"></i>
        </a>
    {% elif child.status == "FAILED" %}
        <a href="{{ child.url }}"
           class="text-red-600 hover:text-red-700 no-underline">
            <i class="fa fa-repeat"></i>
        </a>
    {% else %}
        <span class="text-sm text-red-600">Unknown status "{{ child.status }}"</span>
    {% endif %}
{% endpartialdef %}

{% partialdef content-icon %}
    {% if child.type == "TOPIC" %}
        <i class="fa fa-book"></i>
    {% elif child.type == "FORM" %}
        <i class="fa fa-edit"></i>
    {% elif child.type == "COURSE" %}
        <i class="fa fa-graduation-cap"></i>
    {% elif child.type == "COURSE_PART" %}
        <i class="fa fa-folder"></i>
    {% endif %}
{% endpartialdef %}

{% partialdef content-title %}
    {% if child.type == "COURSE_PART" %}
        <span class="text-gray-600">{{ child.title }}</span>
    {% elif child.url %}
        <a href="{{ child.url }}"
           class="text-gray-600 hover:text-primary-600 no-underline">{{ child.title }}</a>
    {% else %}
        <span class="text-gray-600">{{ child.title }}</span>
    {% endif %}
{% endpartialdef %}

{% partialdef content-row-inner %}
    <span class="text-gray-400 {{ text_size }} {{ counter_width }} shrink-0">
        {% if child_counter %}
            {{ parent_counter }}.{{ child_counter }}
        {% else %}
            {{ parent_counter }}.
        {% endif %}
    </span>
    {% if is_expandable %}
        <button @click="expanded = !expanded"
                class="flex items-center gap-2 text-left hover:text-blue-600 transition-colors cursor-pointer flex-1 min-w-0">
            <span class="text-gray-500 shrink-0 {{ text_size }}">
                <i class="fa" :class="expanded ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
            </span>
            <span class="flex-1 min-w-0 truncate {{ text_size }}">
                {% partial content-title %}
            </span>
        </button>
    {% else %}
        <span class="text-gray-500 shrink-0 {{ text_size }}">
            {% partial content-icon %}
        </span>
        <span class="flex-1 min-w-0 truncate {{ text_size }}">
            {% partial content-title %}
        </span>
    {% endif %}
{% endpartialdef %}

{% partialdef course-children %}
    {% for child in children %}
        {% if child.type == "COURSE_PART" %}
            {# Course Part with expandable children #}
            <div x-data="{ expanded: false }" class="py-1.5">
                <div class="flex items-center justify-between gap-2">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                        {% with parent_counter=forloop.counter is_expandable=True text_size="text-sm" counter_width="w-5" %}
                            {% partial content-row-inner %}
                        {% endwith %}
                    </div>
                    <div class="shrink-0">
                        {% partial status-icon %}
                    </div>
                </div>
                {# Nested children of course part #}
                <div x-show="expanded"
                     x-collapse
                     class="ml-6 mt-1 space-y-1 border-l-2 border-gray-200 pl-3">
                    {% if child.children %}
                        {% for part_child in child.children %}
                            <div class="flex items-center justify-between gap-2 text-sm">
                                <div class="flex items-center gap-1 flex-1 min-w-0">
                                    {% with child=part_child parent_counter=forloop.parentloop.counter child_counter=forloop.counter is_expandable=False text_size="text-xs" counter_width="w-8" %}
                                        {% partial content-row-inner %}
                                    {% endwith %}
                                </div>
                                <div class="shrink-0">
                                    {% with child=part_child %}
                                        {% partial status-icon %}
                                    {% endwith %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <span class="text-xs text-gray-400 italic">No items in this part</span>
                    {% endif %}
                </div>
            </div>
        {% else %}
            {# Regular content item (Topic, Form, Course) #}
            <div class="flex items-center justify-between gap-2 py-1.5">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    {% with parent_counter=forloop.counter is_expandable=False text_size="text-sm" counter_width="w-5" %}
                        {% partial content-row-inner %}
                    {% endwith %}
                </div>
                <div class="shrink-0">
                    {% partial status-icon %}
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% endpartialdef %}

<div class="space-y-2">
    <h1 class="text-2xl">
        {{ course.title }}
    </h1>
    {% if course.subtitle %}
        <p class="text-xl text-gray-600">
            {{ course.subtitle }}
        </p>
    {% endif %}
</div>
<div class="mt-8">
    <h2 class="text-xl">
        Contents
    </h2>
    <div class="mt-4">
        {% partial course-children %}
    </div>
</div>
