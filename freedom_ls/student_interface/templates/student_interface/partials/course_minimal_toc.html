{% partialdef status-icon %}
    {% if child.status == "BLOCKED" %}
        <span class="text-sm text-gray-400">
            <i class="fa fa-lock"></i>
        </span>
    {% elif child.status == "READY" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "IN_PROGRESS" %}
        <a href="{{ child.url }}"
           class="text-primary-600 hover:text-primary-700 no-underline">
            <i class="fa fa-play"></i>
        </a>
    {% elif child.status == "COMPLETE" %}
        <a href="{{ child.url }}"
           class="text-green-600 hover:text-green-700 no-underline">
            <i class="fa fa-check"></i>
        </a>
    {% elif child.status == "FAILED" %}
        <a href="{{ child.url }}"
           class="text-red-600 hover:text-red-700 no-underline">
            <i class="fa fa-repeat"></i>
        </a>
    {% else %}
        <span class="text-sm text-red-600">Unknown status "{{ child.status }}"</span>
    {% endif %}
{% endpartialdef %}

{% partialdef content-icon %}
    {% if child.type == "TOPIC" %}
        <i class="fa fa-book"></i>
    {% elif child.type == "FORM" %}
        <i class="fa fa-edit"></i>
    {% elif child.type == "COURSE" %}
        <i class="fa fa-graduation-cap"></i>
    {% elif child.type == "COURSE_PART" %}
        <i class="fa fa-folder"></i>
    {% endif %}
{% endpartialdef %}

{% partialdef content-title %}
    {% if child.url %}
        <a href="{{ child.url }}" class="text-gray-600 hover:text-primary-600">{{ child.title }}</a>
    {% else %}
        <span class="text-gray-600">{{ child.title }}</span>
    {% endif %}
{% endpartialdef %}

{% partialdef course-children %}
    {% for child in children %}
        {% if child.type == "COURSE_PART" %}
            {# Course Part with expandable children #}
            <div x-data="{ expanded: false }" class="py-2">
                <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <span class="text-gray-400 pr-2">{{ forloop.counter }}.</span>
                        <button @click="expanded = !expanded"
                                class="flex items-center gap-3 text-left hover:text-blue-600 transition-colors cursor-pointer flex-1 min-w-0">
                            <span class="text-gray-500 flex-shrink-0">
                                {% partial content-icon %}
                            </span>
                            <span class="flex-1 min-w-0 truncate">{{ child.title }}</span>
                            <span class="text-sm text-gray-400 flex-shrink-0">
                                <i class="fa" :class="expanded ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
                            </span>
                        </button>
                    </div>
                    <div class="flex-shrink-0">
                        {% partial status-icon %}
                    </div>
                </div>
                {# Nested children of course part #}
                <div x-show="expanded"
                     x-collapse
                     class="ml-12 mt-2 space-y-2 border-l-2 border-gray-200 pl-4">
                    {% if child.children %}
                        {% for part_child in child.children %}
                            <div class="flex items-center justify-between gap-3 text-sm">
                                <div class="flex items-center gap-3 flex-1 min-w-0">
                                    <span class="text-gray-400">{{ forloop.parentloop.counter }}.{{ forloop.counter }}</span>
                                    <span class="text-gray-500 flex-shrink-0">
                                        {% with child=part_child %}
                                            {% partial content-icon %}
                                        {% endwith %}
                                    </span>
                                    <span class="flex-1 min-w-0">
                                        {% with child=part_child %}
                                            {% partial content-title %}
                                        {% endwith %}
                                    </span>
                                </div>
                                <div class="flex-shrink-0">
                                    {% with child=part_child %}
                                        {% partial status-icon %}
                                    {% endwith %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <span class="text-sm text-gray-400 italic">No items in this part</span>
                    {% endif %}
                </div>
            </div>
        {% else %}
            {# Regular content item (Topic, Form, Course) #}
            <div class="flex items-center justify-between gap-3 py-2">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                    <span class="text-gray-400 pr-2">{{ forloop.counter }}.</span>
                    <span class="text-gray-500 flex-shrink-0">
                        {% partial content-icon %}
                    </span>
                    <span class="flex-1 min-w-0">
                        {% if child.url %}
                            <a href="{{ child.url }}">{{ child.title }}</a>
                        {% else %}
                            <span>{{ child.title }}</span>
                        {% endif %}
                    </span>
                </div>
                <div class="flex-shrink-0">
                    {% partial status-icon %}
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% endpartialdef %}

<div class="space-y-2">
    <h1 class="text-2xl">
        {{ course.title }}
    </h1>
    {% if course.subtitle %}
        <p class="text-xl text-gray-600">
            {{ course.subtitle }}
        </p>
    {% endif %}
</div>
<div class="mt-8">
    <h2 class="text-xl">
        Contents
    </h2>
    <div class="mt-4">
        {% partial course-children %}
    </div>
</div>
