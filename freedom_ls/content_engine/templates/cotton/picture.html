<c-vars src alt caption="" />

{% load content_tags %}

{% comment %}
Look up the File object by file_path to get the actual file URL
{% endcomment %}

{% with file_obj=src|get_file_by_path:content_instance %}

    {% if file_obj %}
        <div x-data="{ open: false }" class="my-6">
            <!-- Thumbnail Image -->
            <figure class="max-w-xl mx-auto m-4">
                {# djlint:off H006 #}
                <img src="{{ file_obj.file.url }}"
                     alt="{{ alt }}"
                     @click="open = true"
                     class="w-full h-auto rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-shadow p-4"
                     loading="lazy" />
                {# djlint:on H006 #}
                {% if caption %}
                    <figcaption class="mt-2  text-muted text-center">
                        {{ caption }}
                    </figcaption>
                {% endif %}
            </figure>

            <div x-show="open"
                 x-cloak
                 @keydown.escape.window="open = false"
                 @click="open = false"
                 class="fixed inset-0  flex justify-center items-center  z-50 backdrop-blur-lg">

                <button class="absolute top-0 right-0 bg-surface opacity-50 hover:opacity-70 "
                        @click="open = false">
                    <i class="fa fa-times text-5xl text-foreground "></i>

                </button>

                {% if caption %}
                    <div class="absolute top-0">

                        <p class="text-center text-foreground text-4xl pt-6">
                            {{ caption }}
                        </p>
                    </div>
                {% endif %}

                <div class="relative w-7xl max-h-screen p-6 overflow-auto rounded-sm bg-surface ">

                    <img src="{{ file_obj.file.url }}"
                         alt="{{ alt }}"
                         class="w-full max-h-screen object-contain " />

                </div>

            </div>
        </div>

    {% else %}
        <div class="my-6 p-4 bg-danger/10 border border-danger/20 rounded-lg">
            <p class="text-danger-hover">
                Image not found: {{ src }}
            </p>
        </div>
    {% endif %}

{% endwith %}
