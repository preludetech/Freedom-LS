{% load dict_filters %}


{% partialdef activity_radio %}

<button 
    hx-post="{% url 'bloom_student_interface:action_child_activity_toggle' child.slug activity.slug date %}"
    hx-swap="outerHTML"
    class="cursor-pointer"
    >

    {% if done == True %}
    <i class="fa fa-check-circle text-green-600" title="Done today"></i>
    {% elif done == False %}
    <i class="fa fa-times-circle text-red-600" title="Not done today"></i>
    {% else %}
    <i class="fa fa-question-circle text-gray-400" title="Not yet marked"></i>
    {% endif %}
</button>

{% endpartialdef %}



{% partialdef view_activity_description_button %}
<c-modal title="{{activity.title}}">
    <c-slot name="trigger">
        <button class="btn btn-outline">Description</button>
    </c-slot>

    <div class="pl-3">

        {{activity.rendered_content}}
    </div>

    <c-slot name="footer">
        <button type="button" class="btn btn-outline" @click="open = false">Close</button>
    </c-slot>
</c-modal>
{% endpartialdef %}


{% partialdef stop_activity_button %}
<c-modal title="Are you sure?">
    
    <c-slot name="trigger">
        <button class="btn btn-outline">Stop</button>
    </c-slot>

    <p>Are you sure you would like to stop the activity? </p>
    <p>
        <b>{{activity.title}}</b>
    </p>

    <p>Stopping an activity will remove it from your activity tracker. You will be able to restart it at any time. We will not delete any of your activity logs, you'll still have access to everything.</p>

    <c-slot name="footer">
        <button type="button" class="btn btn-outline" >Stop the activity</button>
        <button type="button" class="btn btn-outline" @click="open = false">Nevermind</button>
    </c-slot>

</c-modal>

{% endpartialdef %}




{% partialdef current_activities_table %}

{% if committed_activities %}


<table class="w-full border-collapse">
    
    <thead>
        <tr>
            <th class="text-left p-2 border-b">Activity</th>
            {% for loop_date in activity_logs %}
            <th class="text-center p-2 border-b {% if forloop.first %}bg-blue-50 font-bold{% endif %}">
                <div class="text-xs">{{ loop_date|date:"D" }}</div>
                <div class="text-sm">{{ loop_date|date:"M j" }}</div>
            </th>
            {% endfor %}
            <th class="p-2 border-b"></th>
        </tr>
    </thead>

    <tbody>
        {% for commitment in committed_activities %}
        <tr class="border-b">
            <td class="p-2">
                <div class="font-semibold">{{ commitment.activity.title }}</div>
                {% if commitment.activity.category %}
                    <div class="text-sm text-gray-500">{{ commitment.activity.category }}</div>
                {% endif %}
                {% with activity=commitment.activity %}
                    {% partial view_activity_description_button %}
                    {% partial stop_activity_button %}
                {% endwith %}
            </td>
            {% for loop_date in activity_logs %}
            <td class="text-center p-2 {% if forloop.first %}bg-blue-50{% endif %}">
                {% with activity=commitment.activity done=activity_logs|dict_get:loop_date|dict_get:commitment.activity.id date=loop_date|date:"Y-m-d" %}
                {% include "bloom_student_interface/partials/activity_tracking.html#activity_radio" %}
                {% endwith %}
            </td>
            {% endfor %}
            <!-- <td class="p-2">
                <a href="{% url 'bloom_student_interface:child_activity' child.slug commitment.activity.slug %}" class="btn btn-primary text-sm">View</a>
            </td> -->
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}

<p>

    You haven't committed to doing any activities with your child yet. Please click on the "configure activities" button below to choose some things to do.
</p>
    
    {% endif %}

{% endpartialdef %}
